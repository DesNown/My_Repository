#:set abertura "Imagem/abertura.png"
#:set cor_azul [.129, .588, .953, 1]
#:set cor_azul_claro [.384, .588, .953, 1]
#:set back [0.275, 0.298, 0.322, 1]
#:set cor_button [.49, .686, .847, 1]
#:set light [.125,.125,.125,1]
#:set dark [.10,.10,.10,1]


#:import MDRectangleFlatButton kivymd.button.MDRectangleFlatButton
# :import MDList kivymd.list.MDList
#:import MDlabel kivymd.label.MDLabel
#:import Factory kivy.factory.Factory
#:import Thread threading.Thread
#:import search_music functool_music.search_music


<Main>:
    Abertura:
        name: 'Abertura'

    Player:
        name: 'Player'


<Abertura>:
    BoxLayout:
        orientation: 'vertical'

        Widget:
            size_hint_y: .5
        BoxLayout:
            size_hint:[1, .45]
            Image:
                source: abertura

        BoxLayout:
            orientation: 'vertical'
            pos_hint: {'top':1}
            spacing: 20
            size_hint_y: .35

            MDRectangleFlatButton:
                text: 'Ir para a pasta Musicas'
                font_size: dp(20)
                pos_hint: {'center_x':.5}
                on_release:
                    Thread(target=app.root.get_screen('Player').load).start()
                    app.root.current = 'Player'
                    app.root.transition.direction = 'down'

            MDRectangleFlatButton:
                text: 'Scanear pasta usada anteriormente'
                font_size: dp(20)
                pos_hint: {'center_x':.5}
                on_release:
                    Thread(target=app.root.get_screen('Player').load, args=['velha']).start()
                    app.root.current = 'Player'
                    app.root.transition.direction = 'down'


        Widget:


<Player>:
    BoxLayout:
        orientation: 'vertical'
        id: box
        # canvas:
        #     Color:
        #         rgba: cor_azul_claro
        #     Rectangle:
        #         pos: self.pos
        #         size: self.size

        BarStatus:

        ScrollView:
            do_scroll_x: False
            bar_color: cor_azul
            bar_inactive_color: cor_azul_claro
            bar_width: dp(3)
            
            BoxLayout:
                id: box_music
                size_hint_y: None
                height: self.minimum_height
                orientation: 'vertical'
                spacing: dp(2)  

        BarPlayer:
        
        
<BarPlayer>:
    size_hint_y: None
    height: 50
    canvas:
        Color:
            rgba: [1,1,1,.05]
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        size_hint_x: .4341
        pos_hint: {'x':.1}
        Label:
            id: label_music
            halign: 'left'
            valign: 'middle'            
            font_size: dp(15)
        

    BoxLayout:
        #Box que contem os botoes LEFT, PAUSE e RIGHT
        spacing: 30
        size_hint_x: .5659
        MYFloatingActionButton:
            icon: 'arrow-left'
            on_release:
                app.root.get_screen('Player').back()

        MYFloatingActionButton:
            id: play
            icon: 'play'
            on_release:
                app.root.get_screen('Player').pause()
                # app.root.get_screen('Player').button() ->> arrumar ainda '-'

        MYFloatingActionButton:
            icon: 'arrow-right'
            on_release: 
                app.root.get_screen('Player').next()


<BarStatus@ActionBar>:
    pos_hint: {'top':1}
    background_image: ''
    background_color: cor_azul
    ActionView:
        ActionPrevious:
            title: 'Abertura'
            on_release:
                app.root.current = 'Abertura'
                app.root.transition.direction = 'right'
        ActionButton:
            canvas.before:
                Color:
                    rgba: (0, 0, 0, .04)
                Rectangle:
                    pos: self.pos
                    size: self.size

            text: 'Sair'
            on_release:
                app.root.get_screen('Abertura').sair()


<MYFloatingActionButton@MDFloatingActionButton>:
    text_color: app.theme_cls.primary_color
    
    pos_hint: {'center_y':.5, 'center_x':.7}
    size_hint: [None, None]
    height: 40
    width: 40
    md_bg_color: [1,1,1,.05]


<MYRaisedButton>:
    halign: 'left'
    font_size: dp(20)
    size_hint: [1, None]
    height: 40
    md_bg_color: dark if app.root.get_screen('Player').contador % 2 == 0 else light
    # on_release:
    #     root.md_bg_color = cor_azul
    on_release: 
        app.root.get_screen('Player').play(search_music(self.text))
